<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Signal dampening correction — tdm_damp • TREX</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Signal dampening correction — tdm_damp"><meta property="og:description" content="When long-term \(K\) time series (~3 years) are provided, one can perform
 a signal dampening correction (when sensors were not re-installed;
 see Peters et al. 2018). Applying the signal dampening
 correction requires  visually inspecting the correction curve
 (see make.plot = TRUE). The correction curve is constructed with
 the day since installation and the day of year (DOY) to account for seasonal changes in \(K\)
 values. The function returns corrected \(K\) values and the applied correction curve."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TREX</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/the-Hull/TREX/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Signal dampening correction</h1>
    <small class="dont-index">Source: <a href="https://github.com/the-Hull/TREX/blob/HEAD/R/tdm_damp.R" class="external-link"><code>R/tdm_damp.R</code></a></small>
    <div class="hidden name"><code>tdm_damp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>When long-term \(K\) time series (~3 years) are provided, one can perform
 a signal dampening correction (when sensors were not re-installed;
 see Peters <em>et al.</em> 2018). Applying the signal dampening
 correction requires  visually inspecting the correction curve
 (see <code>make.plot = TRUE</code>). The correction curve is constructed with
 the day since installation and the day of year (DOY) to account for seasonal changes in \(K\)
 values. The function returns corrected \(K\) values and the applied correction curve.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tdm_damp</span><span class="op">(</span><span class="va">input</span>, k.threshold <span class="op">=</span> <span class="fl">0.05</span>, make.plot <span class="op">=</span> <span class="cn">TRUE</span>, df <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>input</dt>
<dd><p>An <code><a href="is.trex.html">is.trex</a></code>-compliant object (<code>zoo</code> vector, <code>data.frame</code>) of \(K\) values containing
a timestamp and a value column.</p></dd>


<dt>k.threshold</dt>
<dd><p>Numeric, the threshold below which daily maximum \(K\) values should not be considered (default = 0.05).</p></dd>


<dt>make.plot</dt>
<dd><p>Logical; if <code>TRUE</code>, a plot is generated presenting the correction curve and the \(K\) time series.</p></dd>


<dt>df</dt>
<dd><p>Logical; If <code>TRUE</code>, output is provided in a <code>data.frame</code> format
 with a timestamp and a value column. If <code>FALSE</code>, output
 is provided as a <code>zoo</code> vector object (default = FALSE).</p>

<p>@details The function fits a correction curve for signal dampening (e.g., due to wounding)
 according to Peters <em>et al.</em> (2018). A sensor specific function is fitted to daily maximum
 \(K\) values (considering a minimum cut-off threshold; see <code>k.threshold</code>). Dependent variables
 for the function include seasonality (DOY) and days since installation (\(t\)).
 First, seasonal effects are removed by correcting the \(K\) series (residuals; \(Kresid\))
 to a second-order polynomial with DOY. These residuals are then used within a
 non-linear model:
 $$K_{resid} = (a + b * t)/(1 + c * t + d * t^{2})$$</p>
<p>The fitted parameters for \(t\) (with \(a\), \(b\), \(c\) and \(d\)) are used to
 correct \(K\) and scale it to the maximum within the first year of installation.
 <strong>Note, that the stability of the fit has to be visually inspected before using the output data</strong>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code>zoo</code> object or <code>data.frame</code> in the appropriate
 format for other functionalities.
 See <code><a href="tdm_dt.max.html">tdm_dt.max</a></code> output specifications.
 All \(K\) values for each method are provided when an <code><a href="is.trex.html">is.trex</a></code>-object was used as input.
 If an individual time series was provided for input with \(K\) values an alternative output is given:</p>
<p></p>
<dl><dt>k.cor</dt>
<dd><p>corrected \(K\) values according to the correction curve.</p></dd>

   <dt>k</dt>
<dd><p>\(K\) values provided as input.</p></dd>

   <dt>damp.mod</dt>
<dd><p><code>data.frame</code> with the coefficients of the correction curve.</p></dd>


 
</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>Peters RL, Fonti P, Frank DC, Poyatos R, Pappas C, Kahmen A, Carraro V,
Prendin AL, Schneider L, Baltzer JL, Baron-Gafford GA, Dietrich L, Heinrich I,
Minor RL, Sonnentag O, Matheny AM, Wightman MG, Steppe K. 2018.
Quantification of uncertainties in conifer sap flow measured with the thermal
dissipation method. New Phytologist 219:1283-1299 <a href="https://doi.org/10.1111/nph.15241" class="external-link">doi:10.1111/nph.15241</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span> <span class="co">#correct for dampening of the signal</span></span></span>
<span class="r-in"><span><span class="va">raw</span>   <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="is.trex.html">is.trex</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="example.data.html">example.data</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"doy"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    tz <span class="op">=</span> <span class="st">"GMT"</span>,</span></span>
<span class="r-in"><span>    time.format <span class="op">=</span> <span class="st">"%H:%M"</span>,</span></span>
<span class="r-in"><span>    solar.time <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    long.deg <span class="op">=</span> <span class="fl">7.7459</span>,</span></span>
<span class="r-in"><span>    ref.add <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="dt.steps.html">dt.steps</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    input <span class="op">=</span> <span class="va">raw</span>,</span></span>
<span class="r-in"><span>    time.int <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>    max.gap <span class="op">=</span> <span class="fl">60</span>,</span></span>
<span class="r-in"><span>    decimals <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>    df <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">input</span> <span class="op">&lt;</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">input</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="tdm_dt.max.html">tdm_dt.max</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">input</span>,</span></span>
<span class="r-in"><span>    methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pd"</span>, <span class="st">"mw"</span>, <span class="st">"dr"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    det.pd <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    interpolate <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    max.days <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>    df <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">output.data</span> <span class="op">&lt;-</span> <span class="fu">tdm_damp</span><span class="op">(</span><span class="va">input</span>,</span></span>
<span class="r-in"><span>                    k.threshold <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>                    make.plot <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                    df <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">output.data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">output.data</span><span class="op">[[</span><span class="st">"k.dr"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output.data</span><span class="op">[[</span><span class="st">"k.dr"</span><span class="op">]</span><span class="op">]</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="st">"K"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Richard Peters, Christoforos Pappas, Alexander Hurley, Kathy Steppe.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

