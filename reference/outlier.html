<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Data cleaning and outlier detection — outlier • TREX</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Data cleaning and outlier detection — outlier"><meta property="og:description" content="This function launches a Shiny application that
(1) visualizes raw and outlier-free time series interactively
(using plotly),
(2) highlights automatically detected outliers,
(3) allows the user to revise the automatically detected outliers
 and manually include data points, and
 (4) exports the original data, the automatically selected outliers,
  the manually selected outliers, and the outlier-free time series
   in an is.trex-compliant object that can be further processed."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TREX</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/the-Hull/TREX/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Data cleaning and outlier detection</h1>
    <small class="dont-index">Source: <a href="https://github.com/the-Hull/TREX/blob/HEAD/R/outlier.R" class="external-link"><code>R/outlier.R</code></a></small>
    <div class="hidden name"><code>outlier.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function launches a <code>Shiny</code> application that
(1) visualizes raw and outlier-free time series interactively
(using <code>plotly</code>),
(2) highlights automatically detected outliers,
(3) allows the user to revise the automatically detected outliers
 and manually include data points, and
 (4) exports the original data, the automatically selected outliers,
  the manually selected outliers, and the outlier-free time series
   in an <code><a href="is.trex.html">is.trex</a></code>-compliant object that can be further processed.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">outlier</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="value">
    <h2>Value</h2>
    

<p>The function does not return a value,
but allows the user to save a <code>list</code> containing the raw and outlier-free data,
 as well as the automatically and manually selected outliers in separate items.
  Once the user is satisfied with the selected outliers,
   the ‘Download Cleaned Time Series’ button will allow to export this <code>list</code> as a "<code>.Rds</code>"
   file. This file can be subsequently assigned to an object using <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></code>.
 The list contained in this file is called <code>trex_outlier_output</code> and has four <code>data.frames</code>,
  namely <code>series_input</code> with the raw data, <code>select_auto</code> with
  the automatically selected outliers, <code>select_manual</code> with the manually selected outliers,
   and <code>series_cleaned</code> with the outlier-free time series.
  Each of these data frames has a column with the timestamp and a column for the sensor values.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><strong>Note, that due to the interactive nature of the application, the reactive graphs can become
rather slow in updating. We hence suggest breaking long-time series into smaller chunks
that do not strain the available memory too much. Trial and error is useful here, but we
generally suggest working on a maximum of up to one year at a time.</strong>
Once the application is launched,
 the user can load an <code>.RData</code> file where a <code>data.frame</code>
  with a imestamp and sensor data (multiple sensor columns are supported).
  The timestamp in this <code>data.frame</code> should be of class <code>POSIXct</code>.
  Users can select the x and y axes of the interactive time series plots.
  In addition, the user can provide the units of the imported data
  (e.g., degrees \(C\) or \(mV\) for \(\Delta T\) or \(\Delta V\), respectively).
  A parameter (alpha) for automatic outlier detection can be supplied.
  More specifically, the automatic identification of outliers is based on a
  two-step procedure:
    i) the Tukey’s method (Tukey, 1977) is applied to detect statistical outliers
    as values falling outside the range
    \([q_{0.25} - alpha * IQR, q_{0.75} + alpha * IQR]\),
    where \(IQR\) is the interquartile range
    (\(q_{0.75} - q_{0.25}\))
    with \(q_{0.25}\) denoting the 25% lower quartile and \(q_{0.75}\) the
    75% upper quartile, and alpha is a user-defined parameter
    (default value <code>alpha = 3</code>;
    although visual inspection through the interactive plots allows for adjusting
    alpha and optimizing the automatic detection of outliers),
    and ii) the lag-1 differences of the raw data are calculated
    and data points with lag-1 differences greater
    than the mean of the raw input time series, are excluded.
 The raw input data from the provided <code>.RData</code> file are depicted with
 black points in the first plot titled ‘Raw and automatic detection’
 while the automatically detected outliers are also highlighted in this plot in red.
 The user can adjust the parameter <code>alpha</code> and visually inspect the
 automatically detected outliers in order to achieve the optimal automatic outlier selection.
 This plot allows also interactivity (by hovering the mouse in the upper right corner
 the available interactive tools appear, e.g., zoom in/out).
 Also, the lower subpanel of this plot provides a better overview of the temporal extent
 of the data and allows the user to select narrower time window for a more thorough data inspection.</p>
<p>Once the user is satisfied with the automatically selected data points,
 one can proceed to the manual outlier selection.
 The second interactive plot (titled ‘Filtered and manual selection’)
 presents the raw data after removing the automatically detected outliers of the previous step,
  and allows the user to manually select (point, rectangular, and lasso selections are allowed)
   data points. The first selection identifies points to be removed (outliers),
   and their color changes to red. If a point is selected for a second time,
   this will undo its classification as outlier and its color is set back to black (i.e., not an outlier).
  The red-color data points correspond to the selected outliers to be removed from the data,
  in addition to those identified in the automated detection.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># find example file path</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata"</span>, <span class="st">"example.RData"</span>, package <span class="op">=</span> <span class="st">"TREX"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># either copy-paste this into the navigation bar of the file selection window</span></span></span>
<span class="r-in"><span><span class="co"># or navigate here manually for selection</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># launch shiny application</span></span></span>
<span class="r-in"><span><span class="fu">outlier</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># after saving the output, run e.g.:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">my_cleaned_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./cleaned_file.Rds"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With full workflow:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get an example time series</span></span></span>
<span class="r-in"><span><span class="va">raw</span>   <span class="op">&lt;-</span> <span class="fu"><a href="example.data.html">example.data</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"doy"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="is.trex.html">is.trex</a></span><span class="op">(</span><span class="va">raw</span>, tz<span class="op">=</span><span class="st">"GMT"</span>, time.format<span class="op">=</span><span class="st">"%H:%M"</span>,</span></span>
<span class="r-in"><span>                 solar.time<span class="op">=</span><span class="cn">TRUE</span>, long.deg<span class="op">=</span><span class="fl">7.7459</span>, ref.add<span class="op">=</span><span class="cn">FALSE</span>, df<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># clip a period of interest</span></span></span>
<span class="r-in"><span><span class="va">input</span><span class="op">&lt;-</span><span class="fu"><a href="dt.steps.html">dt.steps</a></span><span class="op">(</span><span class="va">input</span>,time.int<span class="op">=</span><span class="fl">60</span>,start<span class="op">=</span><span class="st">"2014-02-01 00:00"</span>,</span></span>
<span class="r-in"><span>                end<span class="op">=</span><span class="st">"2014-05-01 00:00"</span>,max.gap<span class="op">=</span><span class="fl">180</span>,decimals<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># organise a data.frame</span></span></span>
<span class="r-in"><span><span class="va">input_df</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/coredata.html" class="external-link">coredata</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># save the RData file to e.g. a temp file, or your project root directory</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#temp_file_path &lt;- tempfile()</span></span></span>
<span class="r-in"><span><span class="co"># save(input_df, file=temp_file_path)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># project_root_path &lt;- "."</span></span></span>
<span class="r-in"><span><span class="co"># save(input_df, file=project_root_path)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># call the oulier function and navigate to where the "test.RData" is stored</span></span></span>
<span class="r-in"><span><span class="fu">outlier</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Richard Peters, Christoforos Pappas, Alexander Hurley, Kathy Steppe.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

